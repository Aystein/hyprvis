import{r as d}from"./index-BBkUAzwr.js";function p(g,l={}){const t=d.useRef({state:"idle",anchor:{x:0,y:0},start:{x:0,y:0},overlay:null,target:null,frame:void 0,isFirstDrag:!1,isLastDrag:!1}),m=d.useRef(l);m.current=l,d.useEffect(()=>{const o=g.current;if(!o)return;const c=a=>{const u=o.getBoundingClientRect();return{x:a.clientX-u.left,y:a.clientY-u.top}},f=a=>{a.stopPropagation(),a.preventDefault();const{x:u,y}=c(a);if(l.moveTarget==="overlay"){const r=document.createElement("div");r.style.position="absolute",r.style.inset="0",t.current.overlay=r;const e=window.getComputedStyle(o).cursor;r.style.cursor=e,document.body.appendChild(r)}t.current.anchor={x:u,y},t.current.target=a.target;const v=r=>{t.current.frame&&cancelAnimationFrame(t.current.frame),t.current.frame=requestAnimationFrame(()=>{var e,n;r.isFirstDrag=t.current.isFirstDrag,r.isLastDrag=t.current.isLastDrag,(n=(e=m.current).onDrag)==null||n.call(e,r),t.current.start=r.end,t.current.frame=void 0,t.current.isFirstDrag=!1,t.current.isLastDrag=!1})},w=r=>{const{x:e,y:n}=c(r);let s=!1;t.current.state==="mouse_down"&&(Math.abs(e-t.current.start.x)>4||Math.abs(n-t.current.start.y)>4)?(t.current.state="drag",t.current.isFirstDrag=!0,s=!0):t.current.state==="drag"&&(s=!0),s&&v({anchor:t.current.anchor,start:t.current.start,end:{x:e,y:n},movementX:e-t.current.start.x,movementY:n-t.current.start.y,isFirstDrag:t.current.isFirstDrag,isLastDrag:t.current.isLastDrag,clientX:r.clientX,clientY:r.clientY,target:t.current.target})},D=r=>{var e,n;if(t.current.state==="drag"){const{x:s,y:i}=c(r);t.current.isLastDrag=!0,v({anchor:t.current.anchor,start:t.current.start,end:{x:s,y:i},movementX:s-t.current.start.x,movementY:i-t.current.start.y,isFirstDrag:!1,isLastDrag:!0,clientX:r.clientX,clientY:r.clientY,target:t.current.target})}else if(t.current.state==="mouse_down"){const{x:s,y:i}=c(r);(n=(e=m.current).onClick)==null||n.call(e,{x:s,y:i,target:t.current.target})}t.current.overlay&&(t.current.overlay.remove(),t.current.overlay=null),t.current.state="idle",window.removeEventListener("mouseup",D),window.removeEventListener("mousemove",w)};window.addEventListener("mouseup",D),window.addEventListener("mousemove",w),t.current.start={x:u,y},t.current.state="mouse_down"};return o.addEventListener("mousedown",f),()=>{o.removeEventListener("mousedown",f)}},[g])}export{p as u};
