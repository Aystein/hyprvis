import{r as m}from"./index-BBkUAzwr.js";function h(g,f){const t=m.useRef({state:"idle",anchor:{x:0,y:0},start:{x:0,y:0},overlay:null,target:null,frame:void 0,isFirstDrag:!1,isLastDrag:!1}),d=m.useRef(f);d.current=f,m.useEffect(()=>{const c=g.current;if(!c)return;const i=a=>{const u=c.getBoundingClientRect();return{x:a.clientX-u.left,y:a.clientY-u.top}},y=a=>{a.stopPropagation(),a.preventDefault();const{x:u,y:w}=i(a),o=document.createElement("div");o.style.position="absolute",o.style.inset="0",t.current.overlay=o,t.current.anchor={x:u,y:w},t.current.target=a.target;const p=window.getComputedStyle(c).cursor;o.style.cursor=p,document.body.appendChild(o);const D=r=>{t.current.frame&&cancelAnimationFrame(t.current.frame),t.current.frame=requestAnimationFrame(()=>{var e,n;r.isFirstDrag=t.current.isFirstDrag,r.isLastDrag=t.current.isLastDrag,(n=(e=d.current).onDrag)==null||n.call(e,r),t.current.start=r.end,t.current.frame=void 0,t.current.isFirstDrag=!1,t.current.isLastDrag=!1})},x=r=>{const{x:e,y:n}=i(r);let s=!1;t.current.state==="mouse_down"&&(Math.abs(e-t.current.start.x)>4||Math.abs(n-t.current.start.y)>4)?(t.current.state="drag",t.current.isFirstDrag=!0,s=!0):t.current.state==="drag"&&(s=!0),s&&D({anchor:t.current.anchor,start:t.current.start,end:{x:e,y:n},movementX:e-t.current.start.x,movementY:n-t.current.start.y,isFirstDrag:t.current.isFirstDrag,isLastDrag:t.current.isLastDrag,clientX:r.clientX,clientY:r.clientY,target:t.current.target})},v=r=>{var e,n;if(t.current.state==="drag"){const{x:s,y:l}=i(r);t.current.isLastDrag=!0,D({anchor:t.current.anchor,start:t.current.start,end:{x:s,y:l},movementX:s-t.current.start.x,movementY:l-t.current.start.y,isFirstDrag:!1,isLastDrag:!0,clientX:r.clientX,clientY:r.clientY,target:t.current.target})}else if(t.current.state==="mouse_down"){const{x:s,y:l}=i(r);(n=(e=d.current).onClick)==null||n.call(e,{x:s,y:l,target:t.current.target})}o.remove(),t.current.overlay=null,t.current.state="idle",window.removeEventListener("mouseup",v),window.removeEventListener("mousemove",x)};window.addEventListener("mouseup",v),window.addEventListener("mousemove",x),t.current.start={x:u,y:w},t.current.state="mouse_down"};return c.addEventListener("mousedown",y),()=>{c.removeEventListener("mousedown",y)}},[g])}export{h as u};
